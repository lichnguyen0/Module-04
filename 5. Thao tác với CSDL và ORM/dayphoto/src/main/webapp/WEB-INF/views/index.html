<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: head"></head>
<body>

<header th:replace="layout :: header"></header>

<!-- Ảnh NASA -->
<section style="text-align:center; margin-bottom:30px;">
  <h3>Bức ảnh của ngày</h3>
  <img id="img-of-the-day" alt="Photo of the Day"
       style="border-radius:8px; max-width:80%; max-height:600px; width:auto; height:auto;">
</section>

<script>
  const query = 'https://api.nasa.gov/planetary/apod?api_key=r4o7dnrcJqC9SQAWv17IV7eYGqoxfchZ7kjx7ynk';

  fetch(query)
          .then(response => response.json())
          .then(data => {
            const img = document.getElementById('img-of-the-day');
            if (data.media_type === "image") {
              img.src = data.url;
            } else {
              img.src = "https://apod.nasa.gov/apod/image/1901/IC405_Abolfath_3951.jpg";
              img.alt = "Ảnh NASA hôm nay không phải hình, hiển thị ảnh mặc định";
            }
          })
          .catch(err => {
            console.error("NASA API error:", err);
            document.getElementById('img-of-the-day').src = "https://apod.nasa.gov/apod/image/1901/IC405_Abolfath_3951.jpg";
          });
</script>

<!-- Form Feedback -->
<section style="margin-bottom:40px;">
  <h3>Submit your feedback</h3>
  <form th:action="@{/photo/feedback}" method="POST" style="display:flex; flex-direction: column; gap:10px; max-width:400px;">
    <input type="text" name="author" placeholder="Author Name" required
           style="padding:8px; border-radius:5px; border:1px solid #ccc;">
    <textarea name="comment" placeholder="Your feedback" required rows="3"
              style="padding:8px; border-radius:5px; border:1px solid #ccc;"></textarea>
    <label for="rating">Rating:</label>
    <select name="rating" id="rating" required style="padding:5px; border-radius:5px; border:1px solid #ccc; width:100px;">
      <option value="">--Select--</option>
      <option value="1">1 ⭐</option>
      <option value="2">2 ⭐⭐</option>
      <option value="3">3 ⭐⭐⭐</option>
      <option value="4">4 ⭐⭐⭐⭐</option>
      <option value="5">5 ⭐⭐⭐⭐⭐</option>
    </select>
    <input type="submit" value="Submit feedback"
           style="padding:8px 15px; border:none; border-radius:5px; background-color:#4285f4; color:white; font-weight:bold; cursor:pointer; transition:0.3s;">
  </form>
</section>

<!-- Bảng Feedback -->
<section>
  <h3>Today’s feedback</h3>
  <table style="width:100%; border-collapse: collapse; text-align:center;">
    <thead style="background-color:#4285f4; color:white;">
    <tr>
      <th>Name</th>
      <th>feedback</th>
      <th>Rating</th>
      <th>Like</th>
      <th>Reaction</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="f : ${feedbacks}" style="border-bottom:1px solid #ccc;">
      <td th:text="${f.author}"></td>
      <td th:text="${f.comment}"></td>
      <td th:text="${f.rating} + ' ⭐'"></td>
      <td th:text="${f.likes}"></td>
      <td>
        <form th:action="@{/photo/like/{id}(id=${f.id})}" method="POST" style="margin:0;">
          <button type="submit" style="padding:5px 10px; border:none; border-radius:5px; background-color:#ff6b6b; color:white; cursor:pointer; transition:0.3s;">
            ❤️ Like
          </button>
        </form>
      </td>
    </tr>
    </tbody>
  </table>
</section>

<footer th:replace="layout :: footer"></footer>

<style>
  table tbody tr:hover { background-color: #f0f8ff; }
  button:hover { transform: scale(1.05); }
  form input, form select, form textarea { font-size:1em; }
</style>

</body>
</html>
